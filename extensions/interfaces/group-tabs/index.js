import{computed as a,unref as e,defineComponent as t,toRefs as r,resolveComponent as n,resolveDirective as o,openBlock as i,createBlock as d,withCtx as l,withDirectives as s,createElementBlock as c,createCommentVNode as u,createElementVNode as v,toDisplayString as b,createTextVNode as f,ref as p,Fragment as g,renderList as m,renderSlot as y,createVNode as h,watch as k}from"vue";import{useI18n as _}from"vue-i18n";function E({field:t,fields:r,values:n,validationErrors:o}){const{t:i}=_(),d=a((()=>{const a=[Object.assign({},e(t),{hideLabel:!0})];return e(t).meta?.special?.includes("group")&&a.push(...w(e(t).meta?.field,[],e(r))),a})),l=a((()=>{if(!e(n))return!1;const a=Object.keys(e(n));return d.value.some((e=>a.includes(e.field)))})),s=a((()=>{const a=e(o).find((a=>a.field===e(t).field||e(d).find((e=>e.field===a.field))));if(void 0!==a)return"RECORD_NOT_UNIQUE"===a.code?i("validationError.unique"):i(`validationError.${a.type}`,a)}));return{fieldsInSection:d,edited:l,validationMessage:s}}function w(a,e=[],t){const r=t.filter((e=>e.meta?.group===a||null===a&&!e.meta));for(const a of r)a.meta?.special?.includes("group")&&!e.includes(a.meta.field)&&(e.push(a.meta.field),r.push(...w(a.meta.field,e,t)));return r}const x={key:0,class:"edit-dot"},A={class:"field-name"};var V=t({__name:"tab-button",props:{field:{},fields:{},values:{},validationErrors:{},active:{type:Boolean},badge:{}},setup(a){const t=a,{edited:p,validationMessage:g}=E(r(t)),{t:m}=_();return(a,t)=>{const r=n("v-chip"),y=n("v-icon"),h=n("v-button"),k=o("tooltip");return i(),d(h,{id:`tab-${a.field.field}`,class:"tab-button",role:"tab","aria-selected":a.active?"true":"false","aria-controls":`tabpanel-${a.field.field}`,small:""},{default:l((()=>[e(p)?s((i(),c("span",x,null,512)),[[k,e(m)("edited")]]):u("v-if",!0),v("span",A,b(a.field.name),1),a.badge?(i(),d(r,{key:1,"x-small":""},{default:l((()=>[f(b(a.badge),1)])),_:1})):u("v-if",!0),e(g)?s((i(),d(y,{key:2,class:"warning",name:"error",small:""},null,512)),[[k,e(g)]]):u("v-if",!0)])),_:1},8,["id","aria-selected","aria-controls"])}}}),B=[],$=[];function I(a,e){if(a&&"undefined"!=typeof document){var t,r=!0===e.prepend?"prepend":"append",n=!0===e.singleTag,o="string"==typeof e.container?document.querySelector(e.container):document.getElementsByTagName("head")[0];if(n){var i=B.indexOf(o);-1===i&&(i=B.push(o)-1,$[i]={}),t=$[i]&&$[i][r]?$[i][r]:$[i][r]=d()}else t=d();65279===a.charCodeAt(0)&&(a=a.substring(1)),t.styleSheet?t.styleSheet.cssText+=a:t.appendChild(document.createTextNode(a))}function d(){var a=document.createElement("style");if(a.setAttribute("type","text/css"),e.attributes)for(var t=Object.keys(e.attributes),n=0;n<t.length;n++)a.setAttribute(t[n],e.attributes[t[n]]);var i="prepend"===r?"afterbegin":"beforeend";return o.insertAdjacentElement(i,a),a}}I(".v-button[data-v-1955c146] {\n  --v-button-background-color: transparent;\n  --v-button-background-color-hover: transparent;\n  --v-button-border-color: transparent;\n  --v-button-width: unset; }\n  .v-button[data-v-1955c146] [data-v-1955c146] .button {\n    border-color: var(--v-button-border-color); }\n    .v-button[data-v-1955c146] [data-v-1955c146] .button .content[data-v-1955c146] {\n      overflow: visible; }\n    .v-button[data-v-1955c146] [data-v-1955c146] .button[data-v-1955c146]:focus {\n      --v-button-border-color: var(--primary); }\n  .v-button[data-v-1955c146][aria-selected='true'][data-v-1955c146] {\n    --v-button-border-color: var(--background-normal-alt);\n    --v-button-background-color: var(--background-normal-alt);\n    --v-button-background-color-hover: var(--background-normal-alt); }\n  .v-button[data-v-1955c146][data-v-1955c146]:not([aria-selected='true']):hover {\n    --v-button-border-color: var(--background-normal);\n    --v-button-background-color: var(--background-normal);\n    --v-button-background-color-hover: var(--background-normal); }\n  .v-button[data-v-1955c146][data-v-1955c146]:hover .field-name[data-v-1955c146],\n  .v-button[data-v-1955c146][data-v-1955c146]:hover .icon[data-v-1955c146], .v-button[data-v-1955c146][aria-selected='true'][data-v-1955c146] .field-name[data-v-1955c146],\n  .v-button[data-v-1955c146][aria-selected='true'][data-v-1955c146] .icon[data-v-1955c146] {\n    color: var(--foreground-normal-alt); }\n  .v-button[data-v-1955c146][data-v-1955c146]:hover .edit-dot[data-v-1955c146], .v-button[data-v-1955c146][aria-selected='true'][data-v-1955c146] .edit-dot[data-v-1955c146] {\n    background-color: var(--foreground-normal); }\n  .v-button[data-v-1955c146] .field-name[data-v-1955c146],\n  .v-button[data-v-1955c146] .icon[data-v-1955c146] {\n    color: var(--foreground-normal);\n    transition: color var(--fast) var(--transition); }\n  .v-button[data-v-1955c146] .v-chip[data-v-1955c146] {\n    margin: 0 0 0 8px; }\n  .v-button[data-v-1955c146] .edit-dot[data-v-1955c146] {\n    position: absolute;\n    top: 7px;\n    left: -7px;\n    display: block;\n    width: 4px;\n    height: 4px;\n    background-color: var(--foreground-subdued);\n    border-radius: 4px;\n    content: ''; }\n\n.warning[data-v-1955c146] {\n  margin-left: 8px;\n  color: var(--danger); }\n",{});var O=(a,e)=>{const t=a.__vccOpts||a;for(const[a,r]of e)t[a]=r;return t},j=O(V,[["__scopeId","data-v-1955c146"],["__file","tab-button.vue"]]),F=t({__name:"tab-group",props:{modelValue:{},tabFields:{},fields:{},values:{},validationErrors:{}},emits:["update:modelValue"],setup(a){const t=a,r=p([]);function n(a){r.value[a].$el.querySelector("button").focus()}function o(a){const o=function(){const a=r.value.findIndex((a=>a.$el.contains(document.activeElement)));return-1!==a?a:t.modelValue}();switch(a.key){case"ArrowLeft":-1!==o&&n((e(r).length+o-1)%e(r).length);break;case"ArrowRight":-1!==o&&n((o+1)%e(r).length)}}return(a,e)=>(i(),c("div",null,[v("div",{role:"tablist",class:"tab-list",onKeydown:o},[(i(!0),c(g,null,m(a.tabFields,((e,t)=>(i(),d(j,{ref_for:!0,ref_key:"buttons",ref:r,key:e.field,field:e,fields:a.fields,values:a.values,"validation-errors":a.validationErrors,active:t===a.modelValue,onClick:e=>a.$emit("update:modelValue",t)},null,8,["field","fields","values","validation-errors","active","onClick"])))),128))],32),y(a.$slots,"default",{},void 0,!0)]))}});I(".tab-list[data-v-c28b2d53] {\n  display: flex;\n  gap: 0 0.5rem;\n  padding: 2px;\n  border-radius: var(--border-radius-outline);\n  background-color: var(--background-subdued);\n  flex-wrap: wrap; }\n",{});var T=O(F,[["__scopeId","data-v-c28b2d53"],["__file","tab-group.vue"]]);const K=["id"];var M=t({__name:"tab-panel",props:{field:{},fields:{},values:{},initialValues:{},disabled:{type:Boolean},batchMode:{type:Boolean},batchActiveFields:{default:()=>[]},primaryKey:{},loading:{type:Boolean},validationErrors:{default:()=>[]},group:{},multiple:{type:Boolean},direction:{}},setup(a){const t=a,{fieldsInSection:o}=E(r(t));return(a,t)=>{const r=n("v-form");return i(),c("div",{id:`tabpanel-${a.field.field}`,class:"tab-panel"},[h(r,{"initial-values":a.initialValues,fields:e(o),"model-value":a.values,"primary-key":a.primaryKey,group:a.group,"validation-errors":a.validationErrors,loading:a.loading,"batch-mode":a.batchMode,disabled:a.disabled,direction:a.direction,"show-no-visible-fields":!1,"show-validation-errors":!1,"onUpdate:modelValue":t[0]||(t[0]=e=>a.$emit("apply",e))},null,8,["initial-values","fields","model-value","primary-key","group","validation-errors","loading","batch-mode","disabled","direction"])],8,K)}}});I(".accordion-section[data-v-ec8a45c8] {\n  border-top: var(--border-width) solid var(--border-normal); }\n  .accordion-section[data-v-ec8a45c8][data-v-ec8a45c8]:last-child {\n    border-bottom: var(--border-width) solid var(--border-normal); }\n\n.icon[data-v-ec8a45c8] {\n  margin-right: 12px;\n  transform: rotate(-90deg);\n  transition: transform var(--fast) var(--transition); }\n  .icon[data-v-ec8a45c8].active[data-v-ec8a45c8] {\n    transform: rotate(0); }\n\n.warning[data-v-ec8a45c8] {\n  margin-left: 8px;\n  color: var(--danger); }\n\n.fields[data-v-ec8a45c8] {\n  margin: var(--form-vertical-gap) 0; }\n",{});var S=O(M,[["__scopeId","data-v-ec8a45c8"],["__file","tab-panel.vue"]]),C=t({__name:"group-tabs",props:{field:{},fields:{},values:{},initialValues:{},disabled:{type:Boolean},batchMode:{type:Boolean},batchActiveFields:{default:()=>[]},primaryKey:{},loading:{type:Boolean},validationErrors:{default:()=>[]},badge:{},rawEditorEnabled:{type:Boolean},direction:{}},emits:["apply"],setup(a){const t=a,r=p(0),{groupFields:n,groupValues:o}=function(){const a=p(r()),e=p({});return k((()=>t.fields),(()=>{const e=r();s(a.value,e)||(a.value=e)})),k((()=>t.values),(a=>{s(e.value,a)||(e.value=a)})),{groupFields:a,groupValues:e};function r(){return t.fields.filter((a=>a.meta?.group===t.field.meta?.field))}}();function s(a,e){if(a===e)return!0;if("object"!=typeof a||"object"!=typeof e)return!1;if(null===a||null===e)return!1;if(Object.keys(a).length!==Object.keys(e).length)return!1;if(Array.isArray(a)!==Array.isArray(e))return!1;if(Array.isArray(a)&&Array.isArray(e))for(let t=0;t<a.length;t++)if(!s(a[t],e[t]))return!1;for(const t in a)if(!s(a[t],e[t]))return!1;return!0}return k((()=>t.validationErrors),((a,e)=>{if(!t.validationErrors)return;if(s(a,e))return;const o=t.validationErrors.findIndex((a=>n.value.find((e=>e.field===a.field))));-1!==o&&(r.value=o)})),(a,t)=>(i(),d(T,{modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value=a),"tab-fields":e(n),fields:a.fields,values:e(o),"validation-errors":a.validationErrors,class:"group-tabs"},{default:l((()=>[(i(!0),c(g,null,m(e(n),((n,l)=>(i(),c(g,{key:n.field},[r.value===l?(i(),d(S,{key:0,field:n,fields:a.fields,values:e(o),"initial-values":a.initialValues,disabled:a.disabled,"batch-mode":a.batchMode,"batch-active-fields":a.batchActiveFields,"primary-key":a.primaryKey,loading:a.loading,"validation-errors":a.validationErrors,badge:a.badge,"raw-editor-enabled":a.rawEditorEnabled,group:a.field.meta.field,direction:a.direction,onApply:t[0]||(t[0]=e=>a.$emit("apply",e))},null,8,["field","fields","values","initial-values","disabled","batch-mode","batch-active-fields","primary-key","loading","validation-errors","badge","raw-editor-enabled","group","direction"])):u("v-if",!0)],64)))),128))])),_:1},8,["modelValue","tab-fields","fields","values","validation-errors"]))}});I(".group-tabs[data-v-8875afdb] .tab-panel[data-v-8875afdb] {\n  margin-top: var(--form-horizontal-gap); }\n",{});var L={id:"group-tabs",name:"Tab Group",description:"Display fields in a tab group",icon:"tab_group",component:O(C,[["__scopeId","data-v-8875afdb"],["__file","group-tabs.vue"]]),hideLabel:!0,hideLoader:!0,autoKey:!0,types:["alias"],localTypes:["group"],group:"group",options:[]};export{L as default};
